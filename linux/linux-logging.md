# linux-logging


**dmesg** - print or control the kernel ring buffer

monitor live what is happening when you plugin a device:

```
udevadm monitor
```

## Journald

>log files will only be created in the /run/log/journal/ directory and will disappear every time you shut down or reboot the machine. To have it store permanently create /var/log/journal directory.


cofig files `/etc/systemd/journald.conf`

send message to journald with systemd-cat:

```
systemd-cat <command> <arguments>
```

```
systemd-cat ls -l
```

```
echo "This is a message to journald" | systemd-cat
```

### journalctl

**Find failures with journalctl:**

```
journalctl --no-pager --since today \
--grep 'fail|error|fatal' --output json|jq '._EXE' | \
sort | uniq -c | sort --numeric --reverse --key 1
```

to view full logging on RHEL add user to systemd-journal group(or adm but it seems systemd-journal is better):

```
sudo usermod -aG systemd-journal username
```

get to the bottom of log with shift + G combination

Show all logs from the system journal.

```
journalctl
```

Follow new log entries as they are added in real-time.

```
journalctl -f
```

Show logs for a specific service.

```
journalctl -u service_name 
```

Show logs since the last boot.

```
journalctl -b
```

list boots:

```
journalctl --list-boots
```

Show logs since yesterday:

```
journalctl --since=yesterday
```

```
journalctl -S today
```

show log until:

```
journalctl --until=today
```

```
journalctl -U today
```

Show logs within a specific time frame

```
journalctl --since "2015-01-10" --until "2015-01-11 03:00"
```

grep for specific string(case sensitive option is optional, with lower-case it is case insensitive automatically):

```
journalctl -g fail --case-sensitive=true
```

```
journalctl -p err
```

to only see only the specified level of messages:

```
journalctl -p 3..3
```

Show logs with priority level “err” (error).

0 or emerg: This is the emergency level, for things such as kernel panics.

1 or alert: These aren't quite an emergency.

2 or crit: These can be caused by something as simple as a user fumble-fingering his or her password. Theycould also be caused by someone trying to brute-force a password.

3 or err: These could be caused by a service that fails to start, a program that runs
out of memory, problems with accessing a hardware device, and so forth.

4 or warning: most of them will be kernel messages from when you boot up the machine.

5 or notice: just notice of something

6 or info: Most log messages you see should be of the info level.

7 or debug: This is is the lowest priority. It's not enabled by default on rsyslog, but it is on journald.

check different facilities:

```
journalctl --facility auth
```

**auth:** Messages generated by the authorization system, login, su, and so on.

**authpriv**: Messages generated by the authorization system but only readable by
selected users.

**cron**: Messages generated by the cron service.

**daemon**: Messages generated by all system daemons (sshd, ftpd, and so on),

**ftp:** Messages generated by a File Transfer Protocol (FTP) service.

**kern:** Messages generated by the Linux kernel.

**lpr**: Messages generated by the line printer spooling.

**mail**: Messages generated by the operating system's internal mail system.

**mark**: These are periodic timestamps that can be inserted into the logs.

**news**: This facility deals with messages from Usenet newsgroup services, which
have pretty much died off. So, you'll likely never see any of these messages.

**syslog**: Messages that are generated by rsyslog.

**user**: Messages generated by users.

**uucp**: Messages from the Unix-to-Unix copy system. This system also has pretty
much died off, so you'll likely never see any of these messages, either.

**local0** through **local7**: You can use these to define custom facilities

list different facilities:

```
journalctl --facility=help
```


Show all kernel logs.

```
journalctl -k
```

Show all logs in reverse order (newest first).

```
journalctl -r: 
```

Display the most recent [number] of log lines.

```
journalctl -n [number]
```

 Show current disk usage of all journal files.

```
journalctl --disk-usage:
```

Reduce disk usage of the journal to the specified size.

```
journalctl --vacuum-size=1G
```

Show logs in pretty-printed JSON format.

```
journalctl -o json-pretty 
```

Show all unique values that a specific field takes in all log messages.

```
journalctl -F [field]
```

Show all logs for a specific process ID.

```
journalctl _PID=[PID]
```

show log for user with uid:

```
journalctl _UID=1000
```

Jump to the end of a journal and augment the lines with explanation text

```
journalctl -xe
```

## Sealing journald log files for security

create a set of Forward Secure Sealing (FSS) keys:

```
sudo journalctl --setup-keys
```

run a verify operation to ensure that nobody has tampered
with your log files

```
sudo journalctl --verify --verify-key=59de35-d22f82-f28dd1-0e5670/1ce693-35a4e900
```

## Rsyslog


architecture:

- **Originator** : also known as a “Syslog client”,
an originator is responsible for sending the Syslog formatted message
over the network or to the correct application;
- **Relay** : a relay is used in order to forward messages over the network. A relay
can transform the messages in order to enrich it for example (famous
examples include Logstash or fluentd);
- **Collector** : also known as “Syslog servers”, collectors are used in order to store,
visualize and retrieve logs from multiple applications. The collector
can write logs to a wide variety of different outputs : local files,
databases or caches.

files stored in **/var/log**

config files `/etc/rsyslog.conf`

view live logs

```
tail -f /var/log/auth.log
```

create a log message with logger:

```
logger <options> <message>
```

```
logger -p auth.emerg "Somebody tried to connect to the system"
```